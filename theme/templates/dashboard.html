{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="flex h-screen bg-gray-50">
    <!-- Left Sidebar -->
    <div class="w-80 bg-white border-r border-gray-200 flex flex-col">
        <!-- Navigation Tabs -->
        <div class="border-b border-gray-200">
            <nav class="flex space-x-8 px-6 py-4">
                <a href="{% url 'dashboard' %}" class="text-teal-600 border-b-2 border-teal-600 pb-2 px-1 text-sm font-medium">Dashboard</a>
                <a href="{% url 'contracts:contract_list' %}" class="text-gray-500 hover:text-gray-700 pb-2 px-1 text-sm font-medium">Contracts</a>
                <a href="{% url 'contracts:legal_task_board' %}" class="text-gray-500 hover:text-gray-700 pb-2 px-1 text-sm font-medium">Legal Tasks</a>
                <a href="{% url 'contracts:risk_log_list' %}" class="text-gray-500 hover:text-gray-700 pb-2 px-1 text-sm font-medium">Risks</a>
                <a href="{% url 'contracts:compliance_checklist_list' %}" class="text-gray-500 hover:text-gray-700 pb-2 px-1 text-sm font-medium">Compliance</a>
                <a href="{% url 'contracts:trademark_request_list' %}" class="text-gray-500 hover:text-gray-700 pb-2 px-1 text-sm font-medium">Trademarks</a>
            </nav>
        </div>

        <!-- Views Section -->
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-medium text-gray-900">Views</h3>
                <div class="flex items-center space-x-2">
                    <button onclick="addNewView()" class="p-1 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 rounded" title="Add view">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                    </button>
                    <button onclick="collapseViews()" id="views-toggle" class="p-1 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 rounded" title="Collapse views">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="space-y-1">
                <div class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                        </svg>
                        <span>Starred contracts</span>
                    </div>
                    <span class="text-xs text-gray-500">0</span>
                </div>
                <a href="{% url 'contracts:contract_list' %}" class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>All</span>
                    </div>
                    <span class="text-xs text-gray-500">{{ total_contracts }}</span>
                </a>
            </div>
        </div>

        <!-- Repository Section -->
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-medium text-gray-900">Repository</h3>
                <button onclick="collapseRepository()" id="repository-toggle" class="p-1 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 rounded" title="Collapse repository">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
            </div>
            <div class="space-y-1">
                {% for stage, count in pipeline_data %}
                <a href="{% url 'contracts:contract_list' %}?status={{ stage }}" class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>{{ stage }}</span>
                    </div>
                    <span class="text-xs text-gray-500">{{ count }}</span>
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- Workflows Section -->
        <div class="p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-medium text-gray-900">Workflows</h3>
                <button onclick="collapseWorkflows()" id="workflows-toggle" class="p-1 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 rounded" title="Collapse workflows">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
            </div>
            <div class="space-y-1">
                <a href="{% url 'contracts:legal_task_board' %}" class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <span>In progress</span>
                    </div>
                    <span class="text-xs text-gray-500">0</span>
                </a>
                <a href="{% url 'contracts:legal_task_board' %}?assigned_to=me" class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span>Assigned to me</span>
                    </div>
                    <span class="text-xs text-gray-500">0</span>
                </a>
                <a href="{% url 'contracts:contract_list' %}?status=SIGNATURE" class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        <span>Needs my signature</span>
                    </div>
                    <span class="text-xs text-gray-500">0</span>
                </a>
                <a href="{% url 'contracts:contract_list' %}?created_by=me" class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span>Owned by me</span>
                    </div>
                    <span class="text-xs text-gray-500">{{ total_contracts }}</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col">
        <!-- Filters and Actions -->
        <div class="bg-white border-b border-gray-200 px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="{% url 'contracts:contract_create' %}" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                        + New Contract
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <select class="px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-50">
                            <option>All Status</option>
                            <option>Draft</option>
                            <option>Internal Review</option>
                            <option>Negotiation</option>
                            <option>Signature</option>
                        </select>
                        <select class="px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-50">
                            <option>All Types</option>
                            <option>MSA</option>
                            <option>NDA</option>
                            <option>Order Form</option>
                            <option>Statement of Work</option>
                        </select>
                        <input type="text" placeholder="Search contracts..." class="px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-50">
                    </div>
                    <button class="p-2 text-gray-400 hover:text-gray-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Contract List -->
        <div class="flex-1 bg-white">
            <div class="border-b border-gray-200 px-6 py-3">
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">Contract</div>
                    <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">Current Status</div>
                </div>
            </div>

            <!-- Contract Rows -->
            <div class="divide-y divide-gray-200">
                {% for contract in recent_contracts %}
                <a href="{% url 'contracts:contract_detail' contract.pk %}" class="block px-6 py-4 hover:bg-gray-50">
                    <div class="grid grid-cols-2 gap-4 items-center">
                        <div>
                            <div class="text-sm font-medium text-gray-900">{{ contract.title }}</div>
                            <div class="text-xs text-gray-500">{{ contract.counterparty }}</div>
                        </div>
                        <div class="flex items-center space-x-2">
                            {% if contract.status == 'DRAFT' %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">DRAFT</span>
                            {% elif contract.status == 'INTERNAL_REVIEW' %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">REVIEW</span>
                            {% elif contract.status == 'NEGOTIATION' %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">NEGOTIATION</span>
                            {% elif contract.status == 'SIGNATURE' %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">SIGNATURE</span>
                            {% elif contract.status == 'EXECUTED' %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">EXECUTED</span>
                            {% else %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">ACTIVE</span>
                            {% endif %}
                            {% if contract.milestone_date %}
                                <span class="text-xs text-gray-500">Due {{ contract.milestone_date|date:"M d" }}</span>
                            {% endif %}
                        </div>
                    </div>
                </a>
                {% empty %}
                <div class="px-6 py-8 text-center">
                    <div class="text-gray-500">No contracts found.</div>
                    <a href="{% url 'contracts:contract_create' %}" class="text-teal-600 hover:text-teal-700 text-sm font-medium">Create your first contract</a>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            <div class="border-t border-gray-200 bg-white px-6 py-3 flex items-center justify-between">
                <div class="text-sm text-gray-700">
                    Showing {{ recent_contracts|length }} of {{ total_contracts }} contracts
                </div>
                <div class="flex items-center space-x-2">
                    <a href="{% url 'contracts:contract_list' %}" class="px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-50 text-teal-600">View All</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function addNewView() {
    const viewName = prompt('Enter view name:');
    if (viewName && viewName.trim()) {
        const viewsList = document.querySelector('.space-y-1');
        const newView = document.createElement('div');
        newView.className = 'flex items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded';
        newView.innerHTML = `
            <div class="flex items-center">
                <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span>${viewName.trim()}</span>
            </div>
            <span class="text-xs text-gray-500">0</span>
        `;
        viewsList.appendChild(newView);
    }
}

function collapseViews() {
    const viewsList = document.querySelector('.space-y-1');
    const toggle = document.getElementById('views-toggle');
    const svg = toggle.querySelector('svg path');
    
    if (viewsList.style.display === 'none') {
        viewsList.style.display = 'block';
        svg.setAttribute('d', 'M19 9l-7 7-7-7');
        toggle.title = 'Collapse views';
    } else {
        viewsList.style.display = 'none';
        svg.setAttribute('d', 'M9 5l7 7-7 7');
        toggle.title = 'Expand views';
    }
}

function collapseRepository() {
    const repositoryList = document.querySelectorAll('.space-y-1')[1];
    const toggle = document.getElementById('repository-toggle');
    const svg = toggle.querySelector('svg path');
    
    if (repositoryList.style.display === 'none') {
        repositoryList.style.display = 'block';
        svg.setAttribute('d', 'M19 9l-7 7-7-7');
        toggle.title = 'Collapse repository';
    } else {
        repositoryList.style.display = 'none';
        svg.setAttribute('d', 'M9 5l7 7-7 7');
        toggle.title = 'Expand repository';
    }
}

function collapseWorkflows() {
    const workflowsList = document.querySelectorAll('.space-y-1')[2];
    const toggle = document.getElementById('workflows-toggle');
    const svg = toggle.querySelector('svg path');
    
    if (workflowsList.style.display === 'none') {
        workflowsList.style.display = 'block';
        svg.setAttribute('d', 'M19 9l-7 7-7-7');
        toggle.title = 'Collapse workflows';
    } else {
        workflowsList.style.display = 'none';
        svg.setAttribute('d', 'M9 5l7 7-7 7');
        toggle.title = 'Expand workflows';
    }
}
</script>
{% endblock %}